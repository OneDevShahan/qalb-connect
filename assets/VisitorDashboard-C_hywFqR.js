import{r as n,j as t,L as j}from"./index-CfOWARvi.js";import{a as c,o as b,d as l,g as N,u as y,i as k,b as v,s as h}from"./firebaseConfig-aqfbLHAJ.js";import{a as L}from"./index-C88pvD_q.js";import{FaUsers as D}from"./index-DFFrD16l.js";import"./iconBase-DjLeIGj8.js";const C="https://ipapi.co/json/",p="cached_location",S=60*60*1e3,A=async()=>{try{const o=localStorage.getItem(p);if(o){const{ip:d,location:u,timestamp:e}=JSON.parse(o);if(Date.now()-e<S)return console.log("Using cached location data"),{ip:d,location:u}}const s=await L.get(C),{ip:r,city:i}=s.data,x=i||"Unknown";return localStorage.setItem(p,JSON.stringify({ip:r,location:x,timestamp:Date.now()})),{ip:r,location:x}}catch(o){console.error("Error fetching location:",o);const s=localStorage.getItem(p);if(s){const{ip:r,location:i}=JSON.parse(s);return{ip:r,location:i}}return{ip:"Unknown",location:"Unknown"}}},E=()=>{const[o,s]=n.useState(!1);return t.jsxs("div",{className:"relative inline-block",children:[t.jsx("button",{className:"text-xs text-blue-600 dark:text-blue-400 cursor-pointer underline focus:outline-none",onClick:()=>s(!o),onMouseEnter:()=>s(!0),onMouseLeave:()=>s(!1),children:"Whatâ€™s this?"}),o&&t.jsx("div",{className:`absolute top-full left-1/2 -translate-x-1/2 bg-gray-800 text-white text-xs rounded-lg 
          px-3 py-2 shadow-md mt-1 w-56 z-10 transition-opacity duration-300`,children:"This counter tracks unique visitor IPs globally."})]})},U=({visitorCount:o,currentLocation:s,lastLocation:r})=>t.jsxs("div",{className:`w-80 min-h-[22rem] flex flex-col shadow-xl rounded-2xl p-5 border border-gray-300 
      dark:border-gray-700 bg-white dark:bg-gray-800 hover:shadow-2xl transition-all duration-300`,children:[t.jsxs("div",{className:"flex flex-col items-center text-center",children:[t.jsx(D,{className:"text-4xl mb-2 text-green-600 dark:text-green-400"}),t.jsx("h3",{className:"text-xl font-bold text-gray-800 dark:text-white",children:"Unique Visitors"}),t.jsx(E,{})]}),t.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center text-center mt-3",children:[t.jsx("p",{className:"text-4xl font-bold text-green-600 dark:text-green-400",children:o}),t.jsx("p",{className:"text-sm text-gray-500 dark:text-gray-300",children:"People have visited this site!"})]}),t.jsxs("div",{className:"mt-auto",children:[t.jsx("p",{className:"text-sm text-center text-gray-600 dark:text-gray-400",children:"Your Current Location:"}),t.jsx("p",{className:"text-lg font-medium text-gray-800 dark:text-white text-center",children:s})]}),t.jsxs("div",{className:"mt-2",children:[t.jsx("p",{className:"text-sm text-center text-gray-600 dark:text-gray-400",children:"Last Visitor Location:"}),t.jsx("p",{className:"text-lg font-medium text-gray-800 dark:text-white text-center",children:r})]}),t.jsx(j,{to:"/city-visitors",children:t.jsx("button",{className:`flex items-center justify-center w-full bg-gradient-to-r from-green-600 to-green-800 
          text-white px-4 py-2 rounded-lg hover:from-green-500 hover:to-green-700 active:scale-95 transition-all duration-300`,children:"View City Visitors"})})]}),_=()=>{const[o,s]=n.useState(0),[r,i]=n.useState("Fetching..."),[x,d]=n.useState("Unknown");return n.useEffect(()=>{const u=c(l,"users","count"),e=b(u,a=>{a.exists()&&(s(a.data().count||0),d(a.data().lastLocation||"Unknown"))});return()=>e()},[]),n.useEffect(()=>{(async()=>{try{const{ip:e,location:a}=await A();i(a);const m=c(l,"users","count"),f=await N(m);if(f.exists())if((f.data().ipArray||[]).includes(e)){const g=c(l,"users",e);await y(g,{timestamp:new Date})}else{await y(m,{ipArray:v(e),count:k(1),lastLocation:a});const g=c(l,"users",e);await h(g,{ip:e,location:a,timestamp:new Date,count:1})}else{await h(m,{count:1,ipArray:[e],lastLocation:a});const w=c(l,"users",e);await h(w,{ip:e,location:a,timestamp:new Date,count:1})}}catch(e){console.error("Error registering visitor:",e)}})()},[]),t.jsx(U,{visitorCount:o,currentLocation:r,lastLocation:x})};export{_ as default};
